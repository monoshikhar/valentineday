<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>The Universe of Us ğŸŒŒ</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Tangerine:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
    html,body{width:100%;height:100%;overflow:hidden;background:#00000f;}
    body{font-family:'Cormorant Garamond',serif;color:#fff;cursor:none;}

    #galaxyCanvas{position:fixed;inset:0;z-index:1;cursor:none;}

    /* cursor */
    #cur{position:fixed;pointer-events:none;z-index:9999;
      width:20px;height:20px;border:1.5px solid rgba(255,212,0,.8);
      border-radius:50%;transform:translate(-50%,-50%);
      transition:width .2s,height .2s,background .2s;
      box-shadow:0 0 12px rgba(255,212,0,.5);}
    #cur.big{width:38px;height:38px;background:rgba(255,212,0,.1);
      box-shadow:0 0 28px rgba(255,212,0,.9);}
    #curdot{position:fixed;pointer-events:none;z-index:9999;
      width:4px;height:4px;background:#ffd700;
      border-radius:50%;transform:translate(-50%,-50%);}

    /* â”€â”€ OPENING â”€â”€ */
    #opening{position:fixed;inset:0;z-index:100;background:#000;
      display:flex;flex-direction:column;align-items:center;
      justify-content:center;text-align:center;padding:40px 30px;
      transition:opacity .8s ease;}
    .ol{opacity:0;margin-bottom:14px;}
    .ol-tiny{font-family:'Cinzel Decorative',cursive;font-size:.75rem;
      letter-spacing:5px;text-transform:uppercase;color:rgba(255,255,255,.4);}
    .ol-title{font-family:'Cinzel Decorative',cursive;
      font-size:clamp(1.8rem,5.5vw,4rem);letter-spacing:4px;
      background:linear-gradient(135deg,#ffd700,#ff4488,#9b59ff);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
      filter:drop-shadow(0 0 30px rgba(255,68,136,.5));line-height:1.2;}
    .ol-sub{font-family:'Cormorant Garamond',serif;font-style:italic;
      font-size:1.1rem;letter-spacing:3px;color:rgba(255,255,255,.5);}
    .ol-hint{font-size:.9rem;font-style:italic;letter-spacing:2px;
      color:rgba(255,255,255,.3);margin-top:8px;}
    @keyframes fu{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
    @keyframes fi{from{opacity:0}to{opacity:1}}

    #enterBtn{opacity:0;margin-top:44px;background:transparent;
      border:1px solid rgba(255,212,0,.5);color:#ffd700;
      font-family:'Cinzel Decorative',cursive;font-size:.75rem;
      letter-spacing:4px;padding:14px 48px;cursor:pointer;
      transition:all .3s;box-shadow:0 0 20px rgba(255,212,0,.1);
      text-transform:uppercase;}
    #enterBtn:hover{background:rgba(255,212,0,.12);
      box-shadow:0 0 40px rgba(255,212,0,.4);transform:scale(1.05);}

    /* â”€â”€ HUD â”€â”€ */
    #hud{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);
      z-index:40;opacity:0;transition:opacity 1s;pointer-events:none;}
    #hud.on{opacity:1;}
    .hud-pill{background:rgba(0,0,0,.65);border:1px solid rgba(255,212,0,.2);
      border-radius:50px;padding:10px 26px;backdrop-filter:blur(14px);
      display:flex;align-items:center;gap:12px;}
    .hud-lbl{font-family:'Cinzel Decorative',cursive;font-size:.6rem;
      letter-spacing:3px;text-transform:uppercase;color:rgba(255,255,255,.4);}
    .hud-num{font-family:'Tangerine',cursive;font-size:1.6rem;
      font-weight:700;color:#ffd700;}
    .hud-track{width:110px;height:4px;background:rgba(255,255,255,.1);
      border-radius:2px;overflow:hidden;}
    .hud-fill{height:100%;width:0%;border-radius:2px;
      background:linear-gradient(90deg,#9b59ff,#ff4488,#ffd700);
      transition:width .5s ease;box-shadow:0 0 8px #ff4488;}

    #dragh{position:fixed;top:22px;left:50%;transform:translateX(-50%);
      z-index:40;opacity:0;transition:opacity .8s;pointer-events:none;
      font-style:italic;font-size:.9rem;letter-spacing:2px;
      color:rgba(255,255,255,.3);}
    #dragh.on{opacity:1;}

    /* â”€â”€ STAR CARD â”€â”€ */
    #card{position:fixed;z-index:50;opacity:0;pointer-events:none;
      transition:opacity .35s;max-width:290px;width:290px;}
    #card.on{opacity:1;pointer-events:all;}
    .card-box{background:linear-gradient(135deg,rgba(8,2,28,.97),rgba(20,3,42,.97));
      border:1px solid rgba(255,212,0,.3);border-radius:20px;
      padding:26px 22px;box-shadow:0 0 0 1px rgba(255,68,136,.08),
      0 24px 60px rgba(0,0,0,.85);backdrop-filter:blur(18px);}
    .c-num{font-family:'Cinzel Decorative',cursive;font-size:.6rem;
      letter-spacing:4px;color:rgba(255,212,0,.55);
      text-transform:uppercase;margin-bottom:10px;}
    .c-emoji{font-size:2.4rem;display:block;margin-bottom:10px;}
    .c-title{font-family:'Tangerine',cursive;font-size:2.1rem;
      font-weight:700;color:#ffd700;margin-bottom:8px;line-height:1.2;}
    .c-text{font-size:1rem;font-weight:300;color:rgba(255,255,255,.78);
      line-height:1.7;}
    .c-close{margin-top:18px;background:transparent;
      border:1px solid rgba(255,68,136,.4);color:#ff4488;
      font-family:'Cinzel Decorative',cursive;font-size:.6rem;
      letter-spacing:2px;padding:8px 0;border-radius:50px;
      cursor:pointer;transition:all .2s;display:block;width:100%;
      text-align:center;}
    .c-close:hover{background:rgba(255,68,136,.15);
      box-shadow:0 0 18px rgba(255,68,136,.3);}

    /* â”€â”€ FINALE â”€â”€ */
    #finale{position:fixed;inset:0;z-index:200;
      display:flex;flex-direction:column;align-items:center;
      justify-content:center;text-align:center;padding:30px;
      opacity:0;pointer-events:none;transition:opacity 1.5s;}
    #finale.on{opacity:1;pointer-events:all;}
    #finale::before{content:'';position:absolute;inset:0;
      background:radial-gradient(ellipse at 50% 50%,
        rgba(155,89,255,.45) 0%,rgba(255,68,136,.25) 35%,
        rgba(0,0,10,.96) 65%);z-index:-1;}

    .f-eye{font-family:'Cinzel Decorative',cursive;font-size:.65rem;
      letter-spacing:5px;text-transform:uppercase;color:#9b59ff;
      margin-bottom:18px;opacity:0;}
    .f-title{font-family:'Tangerine',cursive;font-weight:700;
      font-size:clamp(3.5rem,10vw,7rem);line-height:1;margin-bottom:8px;
      background:linear-gradient(135deg,#ffd700,#ff4488,#9b59ff,#00e5ff);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      background-clip:text;filter:drop-shadow(0 0 40px rgba(255,68,136,.7));
      opacity:0;}
    .f-sub{font-family:'Cinzel Decorative',cursive;font-size:.7rem;
      letter-spacing:5px;text-transform:uppercase;
      color:rgba(255,255,255,.45);margin-bottom:36px;opacity:0;}
    .f-card{background:rgba(4,0,18,.88);border:1px solid rgba(255,212,0,.22);
      border-radius:22px;padding:32px 28px;max-width:500px;width:100%;
      backdrop-filter:blur(20px);
      box-shadow:0 0 80px rgba(155,89,255,.18),0 30px 80px rgba(0,0,0,.8);
      margin-bottom:28px;opacity:0;}
    .f-msg{font-family:'Tangerine',cursive;font-size:2.2rem;
      font-weight:700;color:#fff8f0;line-height:1.5;margin-bottom:12px;}
    .f-note{font-size:1rem;font-weight:300;font-style:italic;
      color:rgba(255,255,255,.6);line-height:1.8;}
    .f-sig{font-family:'Tangerine',cursive;font-size:2.6rem;
      font-weight:700;color:#ffd700;opacity:0;margin-bottom:22px;}
    .f-again{opacity:0;background:transparent;
      border:1px solid rgba(255,212,0,.4);color:#ffd700;
      font-family:'Cinzel Decorative',cursive;font-size:.6rem;
      letter-spacing:3px;padding:12px 34px;border-radius:50px;
      cursor:pointer;transition:all .3s;text-transform:uppercase;}
    .f-again:hover{background:rgba(255,212,0,.1);
      box-shadow:0 0 30px rgba(255,212,0,.3);}

    @keyframes fadeUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body>

<div id="cur"></div>
<div id="curdot"></div>
<canvas id="galaxyCanvas"></canvas>

<!-- OPENING -->
<div id="opening">
  <div class="ol ol-tiny"  id="ol1">A Valentine's Day Experience</div>
  <div class="ol ol-title" id="ol2">The Universe of Us</div>
  <div class="ol ol-sub"   id="ol3" style="margin-top:6px;">Every star holds a reason I love you</div>
  <div class="ol ol-tiny"  id="ol4" style="margin-top:4px;">February 14, 2026</div>
  <div class="ol ol-hint"  id="ol5">Explore the galaxy Â· Click every star Â· Find what lies at the centre</div>
  <button id="enterBtn" onclick="enterGalaxy()">Begin Our Journey âœ¦</button>
</div>

<!-- HUD -->
<div id="hud">
  <div class="hud-pill">
    <div class="hud-lbl">Stars explored</div>
    <div class="hud-num"><span id="eCount">0</span> / 20</div>
    <div class="hud-track"><div class="hud-fill" id="hFill"></div></div>
  </div>
</div>
<div id="dragh">âœ¦ &nbsp; Drag to explore the galaxy &nbsp; âœ¦</div>

<!-- STAR CARD -->
<div id="card">
  <div class="card-box">
    <div class="c-num"   id="cNum">Star 1 of 20</div>
    <span class="c-emoji" id="cEmoji">âœ¨</span>
    <div class="c-title" id="cTitle">Title</div>
    <div class="c-text"  id="cText">Text</div>
    <button class="c-close" onclick="closeCard()">Continue exploring âœ¦</button>
  </div>
</div>

<!-- FINALE -->
<div id="finale">
  <div class="f-eye"   id="fEye">You found the centre of the universe</div>
  <div class="f-title" id="fTitle">Happy Valentine's Day</div>
  <div class="f-sub"   id="fSub">My Entire Universe Â· My Greatest Love</div>
  <div class="f-card"  id="fCard">
    <div class="f-msg">In the infinite expanse of the cosmos, every star led me to you.</div>
    <div class="f-note">You are not just someone I love â€” you are the reason the universe makes sense to me. Every moment with you is a constellation I never want to stop mapping. You are my north star, my supernova, my home among the stars.<br><br>Happy Valentine's Day, my love. Here's to our infinite universe. ğŸŒŒğŸ’«</div>
  </div>
  <div class="f-sig" id="fSig">Forever Yours, Across Every Galaxy âœ¦</div>
  <button class="f-again" id="fAgain" onclick="replayGalaxy()">Explore Again âœ¦</button>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CURSOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const curEl  = document.getElementById('cur');
const curDot = document.getElementById('curdot');
let mx=innerWidth/2, my=innerHeight/2;
document.addEventListener('mousemove',e=>{
  mx=e.clientX; my=e.clientY;
  curEl.style.left=mx+'px';  curEl.style.top=my+'px';
  curDot.style.left=mx+'px'; curDot.style.top=my+'px';
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CANVAS SETUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const canvas = document.getElementById('galaxyCanvas');
const ctx    = canvas.getContext('2d');
let W = canvas.width  = innerWidth;
let H = canvas.height = innerHeight;
window.addEventListener('resize',()=>{
  W=canvas.width=innerWidth;
  H=canvas.height=innerHeight;
  buildGalaxy();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STAR DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const starData=[
  {emoji:'â˜€ï¸', title:'My Sunshine',     text:'Even on the darkest days, your smile is the light that finds me. You are warmth itself.'},
  {emoji:'ğŸŒŠ', title:'My Calm',         text:'In the chaos of life, you are the stillness I swim toward. My peace. My anchor.'},
  {emoji:'ğŸ¦‹', title:'My Wonder',       text:'You make me see the world with new eyes. Everything is more beautiful because of you.'},
  {emoji:'ğŸ”¥', title:'My Fire',         text:'The passion you ignite in me is unlike anything I have ever known. You set my world alight.'},
  {emoji:'ğŸŒ™', title:'My Night Sky',    text:'Like the moon, you are magnificent even in darkness â€” and you light up my whole world.'},
  {emoji:'ğŸŒ¹', title:'My Forever',      text:'Some things are timeless. The red of a rose. The depth of the ocean. My love for you.'},
  {emoji:'âš¡', title:'My Spark',        text:'The moment I met you, something electric happened. That spark has never stopped glowing.'},
  {emoji:'ğŸµ', title:'My Song',         text:'You are the melody I hear when everything else is silent. My favourite sound in existence.'},
  {emoji:'ğŸŒ¸', title:'My Spring',       text:'You are the feeling of a new beginning. Of warmth returning. Of everything blooming at once.'},
  {emoji:'ğŸ’', title:'My Treasure',     text:'Rare, precious, irreplaceable. I found something in you I will spend a lifetime protecting.'},
  {emoji:'ğŸŒŒ', title:'My Universe',     text:'You contain multitudes. Depths I am still discovering. Worlds I never want to stop exploring.'},
  {emoji:'ğŸ•Šï¸',title:'My Peace',        text:'With you, the noise quiets. The world slows. I breathe. I am home. I am complete.'},
  {emoji:'â­', title:'My Constant',     text:'Stars have guided travellers for centuries. You are the star I navigate my entire life by.'},
  {emoji:'ğŸŒº', title:'My Bloom',        text:'You have made me grow in ways I never thought possible. You bring out the best in me.'},
  {emoji:'ğŸ¦', title:'My Courage',      text:'Loving you has made me brave. You make me want to be better, stronger, more alive.'},
  {emoji:'ğŸ’«', title:'My Magic',        text:'There is something undeniably magical about us. I cannot explain it. I never want to.'},
  {emoji:'ğŸŒˆ', title:'My Colour',       text:'Before you, life was quieter. Less vivid. You painted everything in colours I did not know existed.'},
  {emoji:'ğŸƒ', title:'My Breath',       text:'I did not know what it meant to truly breathe until I had you beside me. You are my air.'},
  {emoji:'ğŸ”ï¸',title:'My Mountain',     text:'Unshakeable. Majestic. You are someone I look up to every single day, in every single way.'},
  {emoji:'ğŸ’–', title:'My Heart',        text:'You are not just someone who holds my heart. You are the reason it beats the way it does.'},
];
const TOTAL=starData.length;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let stars=[], bgStars=[], nebulae=[], shooters=[];
let camX=0, camY=0;
let dragStart=null, dragCam=null, wasDrag=false;
let activeCard=null;
let explored=0;
let gameOn=false, supernovaDone=false;
let ticker=0;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BUILD GALAXY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildGalaxy(){
  stars=[];
  for(let i=0;i<TOTAL;i++){
    const arm=i%3;
    const t2=(i/TOTAL)*Math.PI*5+arm*(Math.PI*2/3);
    const r=130+(i/TOTAL)*Math.min(W,H)*0.36;
    const wx=Math.cos(t2)*r+(Math.random()-.5)*70;
    const wy=Math.sin(t2)*r*0.55+(Math.random()-.5)*50;
    stars.push({
      wx,wy,
      r:4+Math.random()*4.5,
      phase:Math.random()*Math.PI*2,
      hue:[55,320,200,30,275][i%5],
      data:starData[i],
      index:i,
      explored:false,
      hovered:false,
    });
  }

  bgStars=[];
  for(let i=0;i<380;i++){
    bgStars.push({
      wx:(Math.random()-.5)*W*4,
      wy:(Math.random()-.5)*H*4,
      r:Math.random()*1.1,
      alpha:.2+Math.random()*.7,
      phase:Math.random()*Math.PI*2,
    });
  }

  nebulae=[];
  const nbCols=[
    [155,89,255,.07],[255,68,136,.06],[0,229,255,.05],[255,180,0,.05],
    [200,50,255,.06],[0,180,255,.05],[255,100,150,.05],[100,255,200,.04],
  ];
  for(let i=0;i<8;i++){
    nebulae.push({
      wx:(Math.random()-.5)*W*2.2,
      wy:(Math.random()-.5)*H*2.2,
      rx:130+Math.random()*180,
      ry:80+Math.random()*130,
      angle:Math.random()*Math.PI,
      col:nbCols[i],
    });
  }
}

// world â†” screen
function w2s(wx,wy){ return {x:wx+W/2+camX, y:wy+H/2+camY}; }
function s2w(sx,sy){ return {x:sx-W/2-camX, y:sy-H/2-camY}; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DRAG / CLICK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
canvas.addEventListener('mousedown',e=>{
  if(activeCard)return;
  dragStart={x:e.clientX,y:e.clientY};
  dragCam={x:camX,y:camY}; wasDrag=false;
});
window.addEventListener('mousemove',e=>{
  if(!dragStart)return;
  const dx=e.clientX-dragStart.x, dy=e.clientY-dragStart.y;
  if(Math.abs(dx)+Math.abs(dy)>5) wasDrag=true;
  if(wasDrag){camX=dragCam.x+dx; camY=dragCam.y+dy;}
});
window.addEventListener('mouseup',e=>{
  if(dragStart&&!wasDrag) handleTap(e.clientX,e.clientY);
  dragStart=null; wasDrag=false;
});

canvas.addEventListener('touchstart',e=>{
  if(activeCard)return;
  const t=e.touches[0];
  dragStart={x:t.clientX,y:t.clientY};
  dragCam={x:camX,y:camY}; wasDrag=false;
},{passive:true});
window.addEventListener('touchmove',e=>{
  if(!dragStart)return;
  const t=e.touches[0];
  const dx=t.clientX-dragStart.x, dy=t.clientY-dragStart.y;
  if(Math.abs(dx)+Math.abs(dy)>8) wasDrag=true;
  if(wasDrag){camX=dragCam.x+dx; camY=dragCam.y+dy;}
},{passive:true});
window.addEventListener('touchend',e=>{
  if(dragStart&&!wasDrag){
    const t=e.changedTouches[0];
    handleTap(t.clientX,t.clientY);
  }
  dragStart=null; wasDrag=false;
});

// hover
canvas.addEventListener('mousemove',e=>{
  if(!gameOn) return;
  const w=s2w(e.clientX,e.clientY);
  let any=false;
  stars.forEach(s=>{
    const dx=s.wx-w.x, dy=s.wy-w.y;
    s.hovered=dx*dx+dy*dy<Math.pow(Math.max(22,s.r*4),2);
    if(s.hovered) any=true;
  });
  any ? curEl.classList.add('big') : curEl.classList.remove('big');
});

function handleTap(sx,sy){
  if(!gameOn||activeCard)return;
  const w=s2w(sx,sy);
  for(const s of stars){
    const dx=s.wx-w.x, dy=s.wy-w.y;
    if(dx*dx+dy*dy<Math.pow(Math.max(22,s.r*4),2)){
      openCard(s,sx,sy); return;
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STAR CARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openCard(s,sx,sy){
  activeCard=s;
  document.getElementById('cNum').textContent   =`Star ${s.index+1} of ${TOTAL}`;
  document.getElementById('cEmoji').textContent  =s.data.emoji;
  document.getElementById('cTitle').textContent  =s.data.title;
  document.getElementById('cText').textContent   =s.data.text;

  const cw=290,ch=260;
  let cx2=sx+20, cy2=sy-20;
  if(cx2+cw>W-16) cx2=sx-cw-20;
  if(cy2+ch>H-16) cy2=H-ch-16;
  if(cy2<16)      cy2=16;
  const el=document.getElementById('card');
  el.style.left=cx2+'px'; el.style.top=cy2+'px';
  el.classList.add('on');

  if(!s.explored){
    s.explored=true; explored++;
    document.getElementById('eCount').textContent=explored;
    document.getElementById('hFill').style.width=(explored/TOTAL*100)+'%';
    if(explored===TOTAL&&!supernovaDone) setTimeout(triggerSupernova,900);
  }
}
function closeCard(){
  document.getElementById('card').classList.remove('on');
  activeCard=null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SHOOTING STARS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function spawnShooter(){
  const a=.15+Math.random()*.45;
  shooters.push({
    x:Math.random()*W,y:-8,
    vx:Math.cos(a)*13,vy:Math.sin(a)*13,
    life:1,trail:[],
  });
}
setInterval(()=>{ if(gameOn) spawnShooter(); },2400);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DRAW HEART (fixed â€” path only, no save/restore around it)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawHeart(cx2,cy2,size,tick){
  const s=size*(0.92+Math.sin(tick*.7)*.08);
  ctx.beginPath();
  for(let a=0;a<=Math.PI*2+.05;a+=.05){
    const hx=s*16*Math.pow(Math.sin(a),3)/16;
    const hy=-s*(13*Math.cos(a)-5*Math.cos(2*a)-2*Math.cos(3*a)-Math.cos(4*a))/16;
    a<.01 ? ctx.moveTo(cx2+hx,cy2+hy) : ctx.lineTo(cx2+hx,cy2+hy);
  }
  ctx.closePath();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MAIN LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loop(){
  requestAnimationFrame(loop);
  ctx.clearRect(0,0,W,H);
  ticker+=.016;
  if(!gameOn) return;

  // nebulae
  nebulae.forEach(n=>{
    const p=w2s(n.wx,n.wy);
    const [r2,g2,b2,a2]=n.col;
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(n.angle);
    ctx.scale(1,n.ry/n.rx);
    const grd=ctx.createRadialGradient(0,0,0,0,0,n.rx);
    grd.addColorStop(0,`rgba(${r2},${g2},${b2},${a2})`);
    grd.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=grd;
    ctx.beginPath();
    ctx.arc(0,0,n.rx,0,Math.PI*2);
    ctx.fill();
    ctx.restore();
  });

  // bg stars
  bgStars.forEach(s=>{
    const p=w2s(s.wx,s.wy);
    if(p.x<-5||p.x>W+5||p.y<-5||p.y>H+5) return;
    s.phase+=.018;
    const a=s.alpha*(0.55+0.45*Math.sin(s.phase));
    ctx.beginPath(); ctx.arc(p.x,p.y,s.r,0,Math.PI*2);
    ctx.fillStyle=`rgba(255,255,255,${a})`; ctx.fill();
  });

  // shooting stars
  shooters=shooters.filter(s=>{
    s.trail.unshift({x:s.x,y:s.y});
    if(s.trail.length>20) s.trail.pop();
    s.x+=s.vx; s.y+=s.vy; s.life-=.02;
    s.trail.forEach((pt,i)=>{
      const a=s.life*(1-i/s.trail.length)*.85;
      const r=1.8*(1-i/s.trail.length);
      ctx.beginPath(); ctx.arc(pt.x,pt.y,r,0,Math.PI*2);
      ctx.fillStyle=`rgba(255,235,170,${a})`; ctx.fill();
    });
    return s.life>0&&s.x<W+60&&s.y<H+60;
  });

  // pulsing heart at centre
  const cp=w2s(0,0);
  const hs=20+Math.sin(ticker*.65)*3;
  // glow layers
  for(let layer=4;layer>0;layer--){
    drawHeart(cp.x,cp.y,hs+layer*9,ticker);
    ctx.fillStyle=`rgba(255,60,120,${.03*layer})`;
    ctx.fill();
  }
  // fill
  drawHeart(cp.x,cp.y,hs,ticker);
  const hgrd=ctx.createRadialGradient(cp.x,cp.y-hs*.2,0,cp.x,cp.y,hs*2);
  hgrd.addColorStop(0,'rgba(255,130,180,.95)');
  hgrd.addColorStop(.5,'rgba(255,40,100,.75)');
  hgrd.addColorStop(1,'rgba(160,0,70,.2)');
  ctx.fillStyle=hgrd; ctx.fill();
  // centre dot
  ctx.beginPath(); ctx.arc(cp.x,cp.y,2.5,0,Math.PI*2);
  ctx.fillStyle=`rgba(255,255,255,${.6+.4*Math.sin(ticker*2)})`; ctx.fill();

  // interactive stars
  stars.forEach(s=>{
    s.phase+=.028;
    const p=w2s(s.wx,s.wy);
    const pulse=Math.sin(s.phase);
    const r=s.r+pulse*1.4+(s.hovered?3:0);
    const lum=s.explored?90:78;
    const baseA=s.explored?1:.72;
    const glowAmt=s.hovered?40:s.explored?20:10;

    // outer halo
    const grd2=ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,r*5);
    grd2.addColorStop(0,`hsla(${s.hue},100%,70%,.3)`);
    grd2.addColorStop(1,`hsla(${s.hue},100%,70%,0)`);
    ctx.beginPath(); ctx.arc(p.x,p.y,r*5,0,Math.PI*2);
    ctx.fillStyle=grd2; ctx.fill();

    // core
    ctx.save();
    ctx.shadowBlur=glowAmt;
    ctx.shadowColor=`hsl(${s.hue},100%,72%)`;
    ctx.beginPath(); ctx.arc(p.x,p.y,r,0,Math.PI*2);
    ctx.fillStyle=`hsla(${s.hue},100%,${lum}%,${baseA})`;
    ctx.fill();
    ctx.restore();

    // explored ring
    if(s.explored){
      ctx.beginPath(); ctx.arc(p.x,p.y,r+6,0,Math.PI*2);
      ctx.strokeStyle=`hsla(${s.hue},100%,80%,.35)`;
      ctx.lineWidth=1.5; ctx.stroke();
    }

    // cross sparkle
    ctx.save();
    ctx.translate(p.x,p.y); ctx.rotate(ticker*.25+s.phase*.5);
    ctx.strokeStyle=`rgba(255,255,255,${.25+.15*pulse})`;
    ctx.lineWidth=.7;
    const cl=r*2.8;
    ctx.beginPath();
    ctx.moveTo(-cl,0); ctx.lineTo(cl,0);
    ctx.moveTo(0,-cl*.7); ctx.lineTo(0,cl*.7);
    ctx.stroke(); ctx.restore();

    // hover label
    if(s.hovered&&!activeCard){
      ctx.save();
      ctx.font="italic 500 13px 'Cormorant Garamond'";
      ctx.fillStyle='rgba(255,255,255,.9)';
      ctx.textAlign='center'; ctx.textBaseline='bottom';
      ctx.shadowBlur=8; ctx.shadowColor='rgba(0,0,0,.9)';
      ctx.fillText(s.data.title,p.x,p.y-r-10);
      ctx.restore();
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUPERNOVA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function triggerSupernova(){
  supernovaDone=true;
  closeCard();
  // fly camera to centre
  const sx=camX,sy=camY;
  let prog=0;
  const fly=setInterval(()=>{
    prog+=.03;
    const e2=1-Math.pow(1-Math.min(prog,1),3);
    camX=sx*(1-e2); camY=sy*(1-e2);
    if(prog>=1) clearInterval(fly);
  },16);

  setTimeout(()=>{
    const fin=document.getElementById('finale');
    fin.classList.add('on');
    // staggered reveals
    const els=[
      {id:'fEye',  d:300},
      {id:'fTitle',d:700},
      {id:'fSub',  d:1100},
      {id:'fCard', d:1400},
      {id:'fSig',  d:2000},
      {id:'fAgain',d:2600},
    ];
    els.forEach(({id,d})=>{
      setTimeout(()=>{
        const el=document.getElementById(id);
        el.style.animation=`fadeUp .8s ease both`;
      },d);
    });
    burstParticles();
  },1300);
}

function burstParticles(){
  const emjs=['ğŸ’«','âœ¨','ğŸŒŸ','ğŸ’–','ğŸŒ¸','â­','ğŸ’•','ğŸŒŒ'];
  for(let i=0;i<35;i++){
    const el=document.createElement('div');
    const angle=Math.random()*Math.PI*2;
    const dist=80+Math.random()*280;
    const dx=Math.cos(angle)*dist, dy=Math.sin(angle)*dist;
    el.style.cssText=`position:fixed;font-size:${1+Math.random()*1.4}rem;
      left:50%;top:50%;z-index:201;pointer-events:none;opacity:0;
      animation:bst ${.8+Math.random()*.7}s ease forwards;
      animation-delay:${Math.random()*.6}s;
      --dx:${dx}px;--dy:${dy}px;`;
    el.textContent=emjs[Math.floor(Math.random()*emjs.length)];
    document.body.appendChild(el);
    setTimeout(()=>el.remove(),2200);
  }
}
const bstStyle=document.createElement('style');
bstStyle.textContent=`@keyframes bst{
  0%  {opacity:0;transform:translate(-50%,-50%) scale(0);}
  40% {opacity:1;transform:translate(calc(-50% + var(--dx)*.4),calc(-50% + var(--dy)*.4)) scale(1.3);}
  100%{opacity:0;transform:translate(calc(-50% + var(--dx)),calc(-50% + var(--dy))) scale(.5);}
}`;
document.head.appendChild(bstStyle);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  OPENING ANIMATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('DOMContentLoaded',()=>{
  const seq=[
    {id:'ol1',delay:500},
    {id:'ol2',delay:1300},
    {id:'ol3',delay:2200},
    {id:'ol4',delay:3000},
    {id:'ol5',delay:3800},
    {id:'enterBtn',delay:4700},
  ];
  seq.forEach(({id,delay})=>{
    setTimeout(()=>{
      document.getElementById(id).style.animation='fu .7s ease both';
    },delay);
  });
});

function enterGalaxy(){
  const op=document.getElementById('opening');
  op.style.opacity='0';
  setTimeout(()=>{
    op.style.display='none';
    gameOn=true;
    document.getElementById('hud').classList.add('on');
    document.getElementById('dragh').classList.add('on');
    setTimeout(()=>document.getElementById('dragh').classList.remove('on'),4500);
  },800);
}

function replayGalaxy(){
  supernovaDone=false; explored=0;
  stars.forEach(s=>{s.explored=false;s.hovered=false;});
  camX=0; camY=0;
  document.getElementById('eCount').textContent='0';
  document.getElementById('hFill').style.width='0%';
  const fin=document.getElementById('finale');
  fin.classList.remove('on');
  ['fEye','fTitle','fSub','fCard','fSig','fAgain'].forEach(id=>{
    document.getElementById(id).style.animation='none';
    document.getElementById(id).style.opacity='0';
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
buildGalaxy();
loop();
</script>
</body>
</html>
